<section class="locations-section custom-mobile-pt pt-lg-10">
  <div class="container-fluid h-100 p-3 ">
    <div class="row h-100 flex-column flex-lg-row g-0">
      
      <!-- Panel izquierdo -->
      <div class="col-12 col-lg-5 d-flex flex-column justify-content-between p-4 bg-dark text-white">
        
        <!-- Parte superior: título y anotaciones -->
        <div>
          <div class="heading two ">
            <span class="text-uppercase text-muted small">Detalles de su viaje</span>
            <h2 class="">Resumen del <span class="text-warning">traslado</span></h2>
          </div>

          <!-- Información del viaje -->
        

        

          <div class="location-info mb-3">
            <div class="d-flex align-items-center mb-2">
              <img src="assets/img/blue.png" alt="Origen" style="height: 24px; margin-right: 10px;">
              <span class="fw-bold text-uppercase">Origen</span>
            </div>
            <div class="text-light small">
              {{ origenTexto }}
            </div>
          </div>

          <div class="location-info mb-3">
            <div class="d-flex align-items-center mb-2">
              <img src="assets/img/red.png" alt="Destino" style="height: 24px; margin-right: 10px;">
              <span class="fw-bold text-uppercase">Destino</span>
            </div>
            <div class="text-light small">
              {{ destinoTexto }}
            </div>
          </div>
        </div>

        <!-- Info Cards: Distancia, Vehículo y Pasajeros -->
        <div class="d-flex flex-column flex-md-row flex-wrap g-3 mb-3">
          <!-- Distancia -->
          <div class="col-12 col-md-4 px-0 px-md-2">
            <div class="info-card d-flex align-items-center h-100 p-3">
              <div class="icon-container me-3">
                <img src="assets/img/distance.png" alt="Distancia" class="info-icon">
              </div>
              <div class="info-content">
                <h6 class="info-label">Distancia</h6>
                <h4 class="info-value">{{ distanciaKm | number:'1.1-2' }} km</h4>
              </div>
            </div>
          </div>

          <!-- Vehículo -->
          <div class="col-12 col-md-4 px-0 px-md-2">
            <div class="info-card d-flex align-items-center h-100 p-3">
              <div class="icon-container me-3">
                <img [src]="getImagenVehiculo(viajeData.vehiculoSeleccionado, viajeData.vehiculoSubtipoSeleccionado)" 
                     [alt]="(viajeData.vehiculoSeleccionado || 'Vehículo')" 
                     class="info-icon">
              </div>
              <div class="info-content">
                <h6 class="info-label">Vehículo</h6>
                <h4 class="info-value text-truncate" style="max-width: 150px;">
                  {{ viajeData.vehiculoSeleccionado || 'No seleccionado' }}
                  <span *ngIf="viajeData.vehiculoSubtipoSeleccionado" class="d-block small text-muted">
                    {{ viajeData.vehiculoSubtipoSeleccionado }}
                  </span>
                </h4>
              </div>
            </div>
          </div>

          <!-- Pasajeros -->
          <div class="col-12 col-md-4 px-0 px-md-2">
            <div class="info-card d-flex align-items-center h-100 p-3">
              <div class="icon-container me-3">
                <i class="fas fa-users info-icon" style="font-size: 1.75rem;"></i>
              </div>
              <div class="info-content">
                <h6 class="info-label">Pasajeros</h6>
                <h4 class="info-value">{{ viajeData.passengerCount || '0' }}</h4>
              </div>
            </div>
          </div>

          <!-- Tarifa -->
         
        </div>

        <!-- Desglose de la tarifa -->
        <div class="tarifa-detalle mb-3 p-3" style="background-color: #1a1a1a; border-radius: 12px;">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="text-warning m-0">Desglose de la tarifa</h6>
          
          </div>
          
          <div *ngIf="showPriceDetails">
            <!-- Precio base (0-10km) -->
            <div class="d-flex justify-content-between mb-2">
              <span class="text-muted">Precio base (0-10 km):</span>
              <span class="text-white">{{ desgloseTarifa.precioBase | number:'1.2-2' }} $</span>
            </div>
            
            <!-- KM extras si aplica -->
            <div *ngIf="desgloseTarifa.kmExtras > 0" class="d-flex justify-content-between mb-2">
              <div>
                <div class="text-muted">KM adicionales:</div>
                <div class="small text-muted">{{ desgloseTarifa.kmExtras | number:'1.2-2' }} km x {{ desgloseTarifa.precioPorKm | number:'1.2-2' }} $/km</div>
              </div>
              <span class="text-white">{{ (desgloseTarifa.kmExtras * desgloseTarifa.precioPorKm) | number:'1.2-2' }} $</span>
            </div>
          </div>
          
          <!-- Subtotal -->
          <div class="d-flex justify-content-between mb-2 pt-2 border-top border-secondary">
            <div class="d-flex align-items-center">
              <span class="text-muted me-2">Subtotal:</span>
              <button class="btn btn-sm rounded-circle d-inline-flex align-items-center justify-content-center" 
                      (click)="$event.stopPropagation(); togglePriceDetails()" 
                      style="width: 20px; height: 20px; background-color: #d6c500; font-size: 32px   !important; font-weight: bold; border: 1px solid #d6c500; padding: 0;">
                <i class="fas fa-info" style="color: black; font-size: 10px; line-height: 1;"></i>
              </button>
            </div>
            <span class="text-white">{{ desgloseTarifa.subtotal | number:'1.2-2' }} $</span>
          </div>
          
          <!-- IVA -->
          <div class="d-flex justify-content-between mb-2">
            <span class="text-muted">IVA (16%):</span>
            <span class="text-white">{{ desgloseTarifa.iva | number:'1.2-2' }} $</span>
          </div>
          
          <!-- Total -->
          <div class="d-flex justify-content-between mb-0 pt-2 border-top border-secondary">
            <span class="fw-bold">Total:</span>
            <span class="text-warning">{{ desgloseTarifa.total | number:'1.2-2' }} $</span>
          </div>
          <textarea 
          class="form-control mb-4 mt-2" 
          placeholder="¿Alguna indicación adicional para el conductor?"
          style="border: 2px solid #d6c500; background-color: #ffffff2a; color: white; resize: none; border-radius: 12px; min-height: 100px;"
          [(ngModel)]="viajeData.notas"
          (ngModelChange)="actualizarNotas($event)">
        </textarea>
          
          <!-- Botón de Procesar Solicitud (solo en desktop) -->
          <div class="d-none d-lg-block">
            <button class="btn btn-warning w-100 mt-3 py-2 fw-bold" (click)="procesarSolicitud()">
              PROCESAR SOLICITUD
            </button>
          </div>
        </div>

        <!-- Botón fijo en móviles -->
        <div class="fixed-bottom-mobile d-lg-none">
          <button class="btn btn-warning w-100 py-3 fw-bold" (click)="procesarSolicitud()">
            PROCESAR SOLICITUD
          </button>
        </div>
      </div>
      <!-- Fin del panel izquierdo -->

      <!-- Panel derecho (mapa) -->
      <div class="col-12 col-lg-7 p-0">
        <div class="map-container">
          <div #mapRef id="map"></div>
        </div>
      </div>

    </div>
  </div>
</section>

